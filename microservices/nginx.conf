# nginx.conf (Corrected)

# Upstreams for microservices
upstream auth_service {
    server auth:5000;
}

upstream inventory_service {
    server inventory:5001;
}

upstream battle_service {
    server battle:5004;
}

upstream gatcha_service {
    server gatcha:5002;
}

upstream trade_service {
    server trade:5003;
}


server {
    listen 80;
    server_name localhost;

    # Root: send to auth_service (core app)
    location / {
        proxy_pass http://auth_service/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }

    # API: route to correct microservice based on path
    location /api/auth/ {
        proxy_pass http://auth_service/api/auth/;
        proxy_set_header Host $host;
    }
    location /api/inventory/ {
        proxy_pass http://inventory_service/api/inventory/;
        proxy_set_header Host $host;
    }
    location /api/battle/ {
        proxy_pass http://battle_service/api/battle/;
        proxy_set_header Host $host;
    }
    location /api/gatcha/ {
        proxy_pass http://gatcha_service/api/gatcha/;
        proxy_set_header Host $host;
    }
    location /api/trade/ {
        proxy_pass http://trade_service/api/trade/;
        proxy_set_header Host $host;
    }

    # Socket.IO proxy (assume battle_service handles realtime)
    location /socket.io {
        proxy_pass http://battle_service/socket.io;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_read_timeout 86400;
        proxy_send_timeout 86400;
        proxy_buffering off;
        proxy_set_header X-Socket-IO-Path /socket.io;
    }
}
